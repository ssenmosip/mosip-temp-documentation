<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Auth-Angular-User-Guide · MOSIP Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Guidelines"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Auth-Angular-User-Guide · MOSIP Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://your-docusaurus-test-site.com/"/><meta property="og:description" content="# Guidelines"/><meta property="og:image" content="https://your-docusaurus-test-site.com/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://your-docusaurus-test-site.com/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://your-docusaurus-test-site.com/blog/atom.xml" title="MOSIP Documentation Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://your-docusaurus-test-site.com/blog/feed.xml" title="MOSIP Documentation Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/favicon.ico" alt="MOSIP Documentation"/><h2 class="headerTitleWithLogo">MOSIP Documentation</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/Platform-Documentation" target="_self">Docs</a></li><li class=""><a href="/docs/Getting-Started" target="_self">API</a></li><li class=""><a href="/Contributor-Guide" target="_self">Help</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Auth-Angular-User-Guide</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="guidelines"></a><a href="#guidelines" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Guidelines</h1>
<p>Guidelines to implement Authorization and Authentication techniques in the Angular application are detailed in this document.</p>
<p>Before going in to the components let us discuss the following flows of Authorization and Authentication.</p>
<h3><a class="anchor" aria-hidden="true" id="authentication-flow"></a><a href="#authentication-flow" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Authentication flow:</h3>
<ol>
<li>Initially a login request is made passing user credentials to a REST API as specified in the SPECS of that API.</li>
<li>In the response of a successful authentication you will receive user details and an auth_token as the value of the header <strong>&quot;Authorization&quot;</strong>.</li>
<li>Now the received auth token has to be stored and re-used. For example let us use sessionStorage to store the auth_token under the key &quot;TOKEN&quot;.</li>
<li>Now any kind of HTTP/HTTPS requests we make from the application has to be sent by adding a header <strong>&quot;Authorization&quot;</strong> and value of auth_token stored in sessionStorage with key by name &quot;Token&quot; for the purpose of authentication.</li>
<li>If the response comes back with a new token which might be because of previous token getting expired or refresh token mechanisms that happen in the backend, we need to replace the old token with the new one in the session storage.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="authorization-flow"></a><a href="#authorization-flow" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Authorization flow:</h3>
<ol>
<li>After successful login the user details are sent to the client(Angular application/ Browser).</li>
<li>Now store the userDetails in the sessionStorage for example under the key &quot;UserDetails&quot;.</li>
<li>Now we need to hide some pages/components/user action elements etc. based on the roles that the user possess.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="implementation-of-above-flows"></a><a href="#implementation-of-above-flows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementation of above flows:</h3>
<p>To implement the Authentication and Authorization flows mentioned above, all we need to do is implement an Interceptor and a Directive which were mentioned above and detailed below.</p>
<h2><a class="anchor" aria-hidden="true" id="http-interceptor"></a><a href="#http-interceptor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Http Interceptor</h2>
<p>Tasks to be implemented in a Client/UI Http interceptor are:</p>
<ol>
<li>Append <strong>&quot;Authorization&quot;</strong> header to the request using the token value stored in the session storage.</li>
<li>Replace/Add the session storage token value with the one received in the response <strong>&quot;Authorization&quot;</strong> headers.</li>
</ol>
<p>Below code implements the requirements mentioned above:</p>
<pre><code class="hljs css language-JS"><span class="hljs-keyword">import</span> { Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { HttpInterceptor, HttpRequest, HttpHandler, HttpResponse, HttpEvent, HttpEventType } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;
<span class="hljs-keyword">import</span> { Observable } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">import</span> { map, catchError, tap } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>;

@Injectable({
  <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InterceptService</span> <span class="hljs-title">implements</span> <span class="hljs-title">HttpInterceptor</span> </span>{
  <span class="hljs-keyword">constructor</span>() { }

  intercept(request: HttpRequest&lt;any&gt;, <span class="hljs-attr">next</span>: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
    <span class="hljs-keyword">const</span> token = sessionStorage.getItem(<span class="hljs-string">'TOKEN'</span>);
    <span class="hljs-keyword">if</span> (token) {
      request = request.clone({
        <span class="hljs-attr">setHeaders</span>: {
          <span class="hljs-string">'Authorization'</span>: token
        }
      });
    }

    <span class="hljs-keyword">return</span> next.handle(request).pipe(tap(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> HttpResponse) {
        <span class="hljs-keyword">const</span> receivedToken = event.headers.get(<span class="hljs-string">'Authorization'</span>);
        <span class="hljs-keyword">if</span> (receivedToken) {
          sessionStorage.setItem(<span class="hljs-string">'TOKEN'</span>, receivedToken);
        }
      }
    }, err =&gt; {
      <span class="hljs-built_in">console</span>.log(err);
    }));
  }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="roles-directive"></a><a href="#roles-directive" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Roles Directive</h2>
<p>Role of the Roles directive is to fetch roles from UserDetails stored in the session storage and verify if the user has required roles to perform some action or read some details and restrict access accordingly.</p>
<p>Below code implements the requirements mentioned above:</p>
<pre><code class="hljs css language-JS"><span class="hljs-keyword">import</span> { Directive, TemplateRef, ViewContainerRef, Input, ElementRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;

@Directive({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'[appRole]'</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoleDirective</span> </span>{
  <span class="hljs-attr">userRolesString</span>: any;
  userRoles: <span class="hljs-built_in">Array</span>&lt;string&gt;;
  shouldDisplay = <span class="hljs-literal">false</span>;
  requiredRoles: <span class="hljs-built_in">Array</span>&lt;string&gt;;

  <span class="hljs-keyword">constructor</span>(private element: ElementRef) { }

  @Input() <span class="hljs-keyword">set</span> appRole(roles: string) {
    <span class="hljs-keyword">this</span>.element.nativeElement.hidden = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">const</span> userSessionData = sessionStorage.getItem(<span class="hljs-string">'UserDetails'</span>);
    <span class="hljs-keyword">this</span>.userRolesString = <span class="hljs-built_in">JSON</span>.parse(userSessionData).role;
    <span class="hljs-keyword">this</span>.userRoles = <span class="hljs-keyword">this</span>.userRolesString.split(<span class="hljs-string">','</span>);
    <span class="hljs-keyword">this</span>.requiredRoles = roles.split(<span class="hljs-string">','</span>);
    <span class="hljs-keyword">this</span>.shouldDisplay = <span class="hljs-keyword">this</span>.userRoles.some(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-keyword">this</span>.requiredRoles.indexOf(v) !== <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.shouldDisplay) {
      <span class="hljs-keyword">this</span>.element.nativeElement.hidden = <span class="hljs-literal">false</span>;
    }
  }
}

</code></pre>
<p>Now inject the above interceptor and directive in the app.module.ts as follows</p>
<pre><code class="hljs css language-JS">@NgModule({
  <span class="hljs-attr">declarations</span>: [ RoleDirective, ...],
  <span class="hljs-attr">imports</span>: [...],
  <span class="hljs-attr">providers</span>: [{
    <span class="hljs-attr">provide</span>: HTTP_INTERCEPTORS,
    <span class="hljs-attr">useClass</span>: InterceptService,
    <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span>
  }, ...],
  <span class="hljs-attr">bootstrap</span>: [AppComponent]
})
</code></pre>
<p>To activate/deactivate =&gt; show/hide element all we need to do is add the appRole attribute to the HTML element as shown below:</p>
<pre><code class="hljs css language-HTML"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span> <span class="hljs-attr">appRole</span>=<span class="hljs-string">"DIVISION_ADMIN,SUPERVISOR"</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>In the above sample, the add button will only be visible for users with DIVISION_ADMIN or SUPERVISOR role.</p>
<p><strong>Note:</strong> Above mentioned code snippets are not the final implementations. Based on the API spec's and few other factors the method implementations might change a bit. But the component structures remain the same.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#http-interceptor">Http Interceptor</a></li><li><a href="#roles-directive">Roles Directive</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/favicon.ico" alt="MOSIP Documentation" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/docs/en/doc2.html">Guides (or other categories)</a><a href="/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Your Name or Your Company Name</section></footer></div></body></html>